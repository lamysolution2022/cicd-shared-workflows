# 1차 성능 실측 설계서 v1

- 제출 ID: `61a07b6bb340414abed25716e638f5d3`
- 요청 ID: `61a07b6bb340414abed25716e638f5d3`
- 작성일: 2026-02-19
- 작성자: Platform Engineer (CI/CD Owner)
- 범위: 인덱스/동시성 성능 실측 설계 및 측정 기준 정의(실행 제외)

## 1) 실측 목표
- 인덱스 정책과 동시성 제어 정책 조합별 성능 특성 비교
- 읽기/쓰기/경합 상황에서 지연시간, 처리량, 충돌률을 수치로 비교 가능하게 표준화
- 2차 실행 시 즉시 재현 가능한 시나리오/측정 절차 고정

## 2) 시나리오 설계
### S1. 읽기 중심(Read-heavy)
- 목적: 인덱스 유무에 따른 조회 지연시간 및 처리량 차이 확인
- 워크로드: 90% read / 10% write
- 조회 패턴: `tenant_id + business_key` point lookup, 최근 생성순 페이지 조회
- 데이터 규모: 10만 / 50만 / 100만 행 구간별 측정

### S2. 쓰기 중심(Write-heavy)
- 목적: 인덱스 비용이 쓰기 처리량에 미치는 영향 확인
- 워크로드: 20% read / 80% write
- 쓰기 패턴: INSERT + 상태 UPDATE 혼합
- 데이터 분포: 단일 테넌트 집중 vs 다중 테넌트 분산

### S3. 경합 중심(Contention-heavy)
- 목적: 낙관적/비관적 동시성 제어의 충돌률/복구 효율 비교
- 워크로드: 동일 키 집합에 대한 동시 UPDATE
- 경합 강도: 동시 작업자 8/16/32
- 비교 정책:
  1. optimistic lock(version check)
  2. pessimistic lock(SELECT ... FOR UPDATE)

## 3) 정책 비교 매트릭스
| 구분 | 인덱스 정책 | 동시성 정책 | 기대 관찰 포인트 |
|---|---|---|---|
| P1 | 무인덱스 | optimistic | 조회 지연 증가, 충돌률 기준선 |
| P2 | 복합인덱스(tenant_id,business_key) | optimistic | 조회 성능 개선, 충돌률 변화 |
| P3 | 복합인덱스 + 보조인덱스(created_at) | optimistic | 페이지 조회 성능 개선 |
| P4 | 복합인덱스 | pessimistic | 충돌률 감소, 잠금 대기로 인한 지연 변화 |

## 4) 실측 절차(2차 실행용)
1. 데이터셋 초기화 및 워밍업 5분
2. 시나리오별 3회 반복 측정(회차 평균 + 표준편차 계산)
3. p50/p95/p99, TPS, 충돌률(%) 수집
4. 정책별 비교표/박스플롯 생성
5. 권고안 도출(성능/안정성 트레이드오프 포함)

## 5) 측정 기준표
| 지표 | 정의 | 수집 단위 | 합격/판정 기준(초안) |
|---|---|---|---|
| 지연시간 p50 | 요청 지연 중간값 | ms | 기준선 대비 +20% 이내 |
| 지연시간 p95 | 요청 지연 95백분위 | ms | 기준선 대비 +25% 이내 |
| 처리량 | 초당 처리 요청 수 | ops/s | 기준선 대비 -15% 이내 |
| 충돌률 | 동시성 충돌/전체 시도 비율 | % | 5% 이하(경합 시나리오) |
| 재시도 성공률 | 재시도 후 성공 비율 | % | 99% 이상 |

## 6) 권고안 도출 프레임
- 1순위: p95 및 충돌률
- 2순위: TPS
- 3순위: 운영 복잡도(잠금/재시도/장애 복구 난이도)
- 최종 선택 규칙: p95 기준 충족 + 충돌률 5% 이하 정책 우선

## 7) 산출물 형식(2차 실행 시)
- 결과 CSV: 정책/시나리오/회차/지표
- 비교 보고서: 정책별 우위/열위 및 권고안
- 부록: 실행 파라미터(데이터량, 동시성, 런타임)

## 8) 운영 원칙
- Coordination 단일 채널
- Owner 직접 소통 금지
